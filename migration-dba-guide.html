<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migration UTL_FILE - Guide DBA</title>
    <style>
        :root {
            --primary: #0f9d58;
            --primary-dark: #0b7a45;
            --secondary: #1a73e8;
            --warning: #f9ab00;
            --danger: #ea4335;
            --dark: #202124;
            --gray: #5f6368;
            --light-gray: #f1f3f4;
            --white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: var(--light-gray);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 40px 20px;
            text-align: center;
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        section {
            background: var(--white);
            margin: 20px 0;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
        }

        section h3 {
            color: var(--dark);
            margin: 20px 0 15px 0;
            font-size: 1.2rem;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .alert-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .alert-success {
            background: #e6f4ea;
            border-left: 4px solid var(--primary);
        }

        .alert-info {
            background: #e8f0fe;
            border-left: 4px solid var(--secondary);
        }

        .alert-warning {
            background: #fef7e0;
            border-left: 4px solid var(--warning);
        }

        .alert-danger {
            background: #fce8e6;
            border-left: 4px solid var(--danger);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.95rem;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }

        th {
            background: var(--primary);
            color: var(--white);
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: var(--light-gray);
        }

        tr:hover {
            background: #e8f0fe;
        }

        .code-container {
            position: relative;
            margin: 15px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .code-header {
            background: var(--dark);
            color: var(--white);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .copy-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 6px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: var(--primary-dark);
        }

        .copy-btn.copied {
            background: var(--secondary);
        }

        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            max-height: 400px;
        }

        .checklist {
            list-style: none;
            padding: 0;
        }

        .checklist li {
            padding: 15px;
            margin: 10px 0;
            background: var(--light-gray);
            border-radius: 8px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .checklist li.done {
            background: #e6f4ea;
            border-left: 4px solid var(--primary);
        }

        .checklist li.pending {
            background: #fef7e0;
            border-left: 4px solid var(--warning);
        }

        .checklist li.blocked {
            background: #fce8e6;
            border-left: 4px solid var(--danger);
        }

        .check-box {
            width: 24px;
            height: 24px;
            border: 2px solid var(--gray);
            border-radius: 4px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .check-box.checked {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .step-number {
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .email-template {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: var(--white);
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
        }

        .card h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .tag-toi {
            background: #e6f4ea;
            color: var(--primary);
        }

        .tag-admin {
            background: #e8f0fe;
            color: var(--secondary);
        }

        .tag-attente {
            background: #fef7e0;
            color: #b45309;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        footer {
            background: var(--dark);
            color: var(--white);
            padding: 20px;
            text-align: center;
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.6rem;
            }
            section {
                padding: 15px;
            }
        }

        @media print {
            .copy-btn, .check-box {
                display: none;
            }
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ› ï¸ Migration UTL_FILE vers ExaCC</h1>
    <p class="subtitle">Guide DBA - Focus sur ton pÃ©rimÃ¨tre uniquement</p>
    <span class="badge">Tu gÃ¨res la base â€¢ Les admins OCI gÃ¨rent le cloud</span>
</header>

<div class="container">

    <!-- Info Multi-SchÃ©mas -->
    <section style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border: 2px solid #4caf50;">
        <h2>ğŸ¯ Important : Migration Multi-SchÃ©mas</h2>

        <div class="alert alert-success">
            <span class="alert-icon">ğŸ’¡</span>
            <div>
                <strong>Connecte-toi Ã  chaque schÃ©ma applicatif dans SQL Developer</strong><br>
                Les scripts utilisent <code>user_source</code> qui affiche automatiquement le code du schÃ©ma connectÃ©. Pas besoin de modifier les scripts !
            </div>
        </div>

        <div class="alert alert-warning">
            <span class="alert-icon">âš ï¸</span>
            <div>
                <strong>Ne migre que tes schÃ©mas applicatifs !</strong><br>
                Les schÃ©mas systÃ¨me Oracle (<code>SYS</code>, <code>SYSTEM</code>, <code>XDB</code>, etc.) sont gÃ©rÃ©s automatiquement par Oracle lors de la migration vers ExaCC. Tu ne dois jamais les modifier.
            </div>
        </div>

        <h3>ğŸ“‹ ProcÃ©dure pour chaque schÃ©ma applicatif</h3>
        <div style="background: white; border-radius: 10px; padding: 20px; margin: 15px 0;">
            <ol style="padding-left: 20px; margin: 15px 0;">
                <li style="margin: 10px 0;"><strong>Dans SQL Developer :</strong> CrÃ©e une connexion pour ton schÃ©ma applicatif (ou utilise une existante)</li>
                <li style="margin: 10px 0;"><strong>Connecte-toi</strong> Ã  ce schÃ©ma</li>
                <li style="margin: 10px 0;"><strong>ExÃ©cute l'audit</strong> (le script utilise <code>user_source</code> = ton schÃ©ma connectÃ©)</li>
                <li style="margin: 10px 0;"><strong>Note les rÃ©sultats</strong></li>
                <li style="margin: 10px 0;"><strong>RÃ©pÃ¨te</strong> pour chaque schÃ©ma applicatif</li>
            </ol>
        </div>

        <h3>ğŸ” Script d'audit UTL_FILE (schÃ©ma connectÃ©)</h3>
        <div class="alert alert-info">
            <span class="alert-icon">âš¡</span>
            <div>
                <strong>ExÃ©cute ce script dans SQL Developer</strong><br>
                Il analyse automatiquement le schÃ©ma sur lequel tu es connectÃ©. Pas besoin de modifier le script !
            </div>
        </div>

        <div class="code-container">
            <div class="code-header">
                <span>SQL - Audit UTL_FILE du schÃ©ma connectÃ©</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- ============================================
-- AUDIT UTL_FILE - SCHÃ‰MA CONNECTÃ‰
-- ============================================
-- ExÃ©cute ce script connectÃ© Ã  ton schÃ©ma applicatif dans SQL Developer
-- user_source = code source du schÃ©ma sur lequel tu es connectÃ©

-- 1. Afficher le schÃ©ma courant
SELECT USER AS schema_courant FROM DUAL;


-- 2. Nombre total de rÃ©fÃ©rences UTL_FILE dans ce schÃ©ma
SELECT COUNT(*) AS total_references_utl_file
FROM user_source
WHERE UPPER(text) LIKE '%UTL_FILE%';


-- 3. DÃ©tail : quels objets utilisent UTL_FILE ?
SELECT
    name AS object_name,
    type AS object_type,
    COUNT(*) AS nb_lignes
FROM user_source
WHERE UPPER(text) LIKE '%UTL_FILE%'
GROUP BY name, type
ORDER BY nb_lignes DESC;


-- 4. Voir le code exact (lignes contenant UTL_FILE)
SELECT
    name AS object_name,
    type AS object_type,
    line AS numero_ligne,
    text AS code
FROM user_source
WHERE UPPER(text) LIKE '%UTL_FILE%'
ORDER BY name, type, line;</code></pre>
        </div>

        <h3>ğŸ“Š Connexion SYSDBA : Identifier les schÃ©mas Ã  migrer</h3>
        <div class="alert alert-info">
            <span class="alert-icon">ğŸ”‘</span>
            <div>
                <strong>ConnectÃ© en SYSDBA ?</strong><br>
                Utilise ces commandes pour identifier rapidement tous les schÃ©mas qui utilisent UTL_FILE.
            </div>
        </div>

        <div class="code-container">
            <div class="code-header">
                <span>SQL - Lister tous les schÃ©mas utilisant UTL_FILE (SYSDBA)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- ============================================
-- LISTER LES SCHÃ‰MAS UTILISANT UTL_FILE
-- ============================================
-- ExÃ©cute connectÃ© en SYSDBA (sqlplus / as sysdba)

-- 1. Liste simple des schÃ©mas
SELECT DISTINCT owner AS schema_name
FROM dba_source
WHERE UPPER(text) LIKE '%UTL_FILE%'
  AND owner NOT IN ('SYS', 'SYSTEM', 'ORACLE_OCM', 'XDB', 'WMSYS')
ORDER BY owner;


-- 2. Avec le nombre de rÃ©fÃ©rences par schÃ©ma
SELECT owner AS schema_name, COUNT(*) AS nb_references
FROM dba_source
WHERE UPPER(text) LIKE '%UTL_FILE%'
  AND owner NOT IN ('SYS', 'SYSTEM', 'ORACLE_OCM', 'XDB', 'WMSYS')
GROUP BY owner
ORDER BY nb_references DESC;</code></pre>
        </div>

        <div class="code-container">
            <div class="code-header">
                <span>SQL - Lister tous les schÃ©mas de la base (SYSDBA)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- Lister tous les schÃ©mas (utilisateurs) de la base
SELECT username FROM dba_users ORDER BY username;

-- Lister uniquement les schÃ©mas applicatifs (sans schÃ©mas systÃ¨me)
SELECT username
FROM dba_users
WHERE username NOT IN (
    'SYS', 'SYSTEM', 'ORACLE_OCM', 'XDB', 'WMSYS', 'CTXSYS', 'MDSYS',
    'OLAPSYS', 'ORDDATA', 'ORDSYS', 'OUTLN', 'DBSNMP', 'APPQOSSYS',
    'DBSFWUSER', 'GGSYS', 'ANONYMOUS', 'AUDSYS', 'DIP', 'DVF', 'DVSYS',
    'GSMADMIN_INTERNAL', 'GSMCATUSER', 'GSMUSER', 'LBACSYS', 'OJVMSYS',
    'REMOTE_SCHEDULER_AGENT', 'SYS$UMF', 'SYSBACKUP', 'SYSDG', 'SYSKM', 'SYSRAC'
)
  AND username NOT LIKE 'APEX%'
  AND username NOT LIKE 'FLOWS_%'
  AND username NOT LIKE 'OWA%'
  AND account_status = 'OPEN'
ORDER BY username;</code></pre>
        </div>
    </section>

    <!-- RÃ©partition des rÃ´les -->
    <section>
        <h2>ğŸ‘¥ RÃ©partition des RÃ´les</h2>

        <div class="alert alert-success">
            <span class="alert-icon">âœ…</span>
            <div>
                <strong>Bonne nouvelle !</strong><br>
                Tu n'as pas besoin de gÃ©rer les API Keys, les buckets ou les policies OCI. Les admins cloud s'en occupent.
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>TÃ¢che</th>
                    <th>Qui ?</th>
                    <th>Statut</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>CrÃ©er le bucket Object Storage</td>
                    <td><span class="tag tag-admin">Admin OCI</span></td>
                    <td>Ã€ demander</td>
                </tr>
                <tr>
                    <td>GÃ©nÃ©rer les API Keys</td>
                    <td><span class="tag tag-admin">Admin OCI</span></td>
                    <td>Ã€ demander</td>
                </tr>
                <tr>
                    <td>Configurer les IAM Policies</td>
                    <td><span class="tag tag-admin">Admin OCI</span></td>
                    <td>Ã€ demander</td>
                </tr>
                <tr>
                    <td>CrÃ©er le credential DBMS_CLOUD en base</td>
                    <td><span class="tag tag-admin">Admin OCI</span> ou <span class="tag tag-toi">Toi</span></td>
                    <td>Ã€ clarifier</td>
                </tr>
                <tr>
                    <td>Configurer les ACL rÃ©seau</td>
                    <td><span class="tag tag-admin">Admin OCI</span></td>
                    <td>Ã€ demander</td>
                </tr>
                <tr style="background: #e6f4ea;">
                    <td><strong>Audit du code UTL_FILE</strong></td>
                    <td><span class="tag tag-toi">Toi (DBA)</span></td>
                    <td>Ã€ faire maintenant</td>
                </tr>
                <tr style="background: #e6f4ea;">
                    <td><strong>CrÃ©er la table de mapping</strong></td>
                    <td><span class="tag tag-toi">Toi (DBA)</span></td>
                    <td>AprÃ¨s retour admins</td>
                </tr>
                <tr style="background: #e6f4ea;">
                    <td><strong>DÃ©ployer le package wrapper</strong></td>
                    <td><span class="tag tag-toi">Toi (DBA)</span></td>
                    <td>AprÃ¨s retour admins</td>
                </tr>
                <tr style="background: #e6f4ea;">
                    <td><strong>Remplacer UTL_FILE dans le code</strong></td>
                    <td><span class="tag tag-toi">Toi (DBA)</span></td>
                    <td>AprÃ¨s wrapper</td>
                </tr>
                <tr style="background: #e6f4ea;">
                    <td><strong>Tests de validation</strong></td>
                    <td><span class="tag tag-toi">Toi (DBA)</span></td>
                    <td>Final</td>
                </tr>
            </tbody>
        </table>
    </section>

    <!-- Email aux admins -->
    <section>
        <h2>ğŸ“§ Email Ã  envoyer aux Admins OCI</h2>

        <div class="alert alert-info">
            <span class="alert-icon">ğŸ“¨</span>
            <div>
                <strong>PremiÃ¨re Ã©tape</strong><br>
                Envoie cet email aux admins OCI pour obtenir les informations nÃ©cessaires.
            </div>
        </div>

        <div class="code-container">
            <div class="code-header">
                <span>Email - Demande aux admins OCI</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>Objet : [Migration ExaCC] Demande configuration Object Storage pour remplacement UTL_FILE

Bonjour,

Dans le cadre de la migration vers ExaCC, nous devons remplacer les appels
UTL_FILE par DBMS_CLOUD + Object Storage car l'accÃ¨s au filesystem local
n'est plus disponible sur ExaCC.

AprÃ¨s audit, nous avons identifiÃ© plus de 1000 utilisations de UTL_FILE
dans notre base de donnÃ©es.

Pourriez-vous nous fournir les Ã©lÃ©ments suivants :

1. URI DU BUCKET OBJECT STORAGE
   Format attendu :
   https://objectstorage.[region].oraclecloud.com/n/[namespace]/b/[bucket]/o/

   Exemple : https://objectstorage.eu-paris-1.oraclecloud.com/n/monnamespace/b/db-files/o/

2. NOM DU CREDENTIAL DBMS_CLOUD
   Le credential doit Ãªtre crÃ©Ã© dans la base de donnÃ©es pour permettre
   l'authentification vers Object Storage.

   Question : Ce credential est-il dÃ©jÃ  crÃ©Ã© ? Si oui, quel est son nom ?
   Sinon, pouvez-vous le crÃ©er ou me fournir les informations (API Key)
   pour que je le crÃ©e ?

3. CONFIRMATION DES ACL RÃ‰SEAU
   La base doit pouvoir accÃ©der Ã  *.oraclecloud.com sur le port 443 (HTTPS).
   Pouvez-vous confirmer que c'est configurÃ© ?

4. DOSSIERS (PREFIXES) Ã€ CRÃ‰ER DANS LE BUCKET
   Voici la liste des directories Oracle actuels Ã  migrer :

   [LISTE Ã€ COMPLÃ‰TER APRÃˆS AUDIT - voir ci-dessous]

Merci de me tenir informÃ© dÃ¨s que ces Ã©lÃ©ments seront disponibles.

Cordialement,
[Ton nom]</code></pre>
        </div>

        <h3>ğŸ“‹ Liste des directories Ã  inclure dans l'email</h3>
        <p>ExÃ©cute d'abord l'audit pour obtenir la liste :</p>

        <div class="code-container">
            <div class="code-header">
                <span>SQL - Lister les directories utilisÃ©s par UTL_FILE</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- Trouver tous les directories rÃ©fÃ©rencÃ©s dans le code UTL_FILE
SELECT DISTINCT
    REGEXP_SUBSTR(text, '''([A-Z_]+)''', 1, 1, 'i', 1) AS directory_name
FROM dba_source
WHERE UPPER(text) LIKE '%UTL_FILE.FOPEN%'
  AND REGEXP_SUBSTR(text, '''([A-Z_]+)''', 1, 1, 'i', 1) IS NOT NULL
ORDER BY 1;

-- Ou lister tous les directories Oracle existants
SELECT directory_name, directory_path
FROM dba_directories
WHERE owner NOT IN ('SYS', 'SYSTEM')
ORDER BY directory_name;</code></pre>
        </div>
    </section>

    <!-- Ã‰tape 1.5 : Identifier les directories -->
    <section>
        <h2>ğŸ“ Ã‰tape 1.5 : Identifier les Dossiers Ã  CrÃ©er dans Object Storage</h2>

        <div class="alert alert-info">
            <span class="alert-icon">ğŸ’¡</span>
            <div>
                <strong>Principe important</strong><br>
                Les dossiers (prefixes) Ã  crÃ©er dans le bucket Object Storage sont <strong>les mÃªmes noms</strong> que tes directories Oracle actuels. Ainsi, ton code n'a pas besoin de changer !
            </div>
        </div>

        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #2196f3;">
            <h3 style="margin-top: 0; color: #1565c0;">ğŸ”„ Correspondance Directory Oracle â†’ Dossier Object Storage</h3>
            <table style="width: 100%; margin: 15px 0; background: white; border-radius: 10px;">
                <thead>
                    <tr>
                        <th style="background: #1565c0; color: white; padding: 12px;">Avant (On-Premise)</th>
                        <th style="background: #1565c0; color: white; padding: 12px;">AprÃ¨s (Object Storage)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd;">
                            <code>UTL_FILE.FOPEN('<strong>DATA_EXPORT</strong>', 'fichier.txt')</code><br>
                            <small style="color: #666;">Directory â†’ /u01/app/data/</small>
                        </td>
                        <td style="padding: 12px; border: 1px solid #ddd;">
                            Fichier stockÃ© dans : <code>bucket/<strong>DATA_EXPORT</strong>/fichier.txt</code>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd;">
                            <code>UTL_FILE.FOPEN('<strong>LOG_DIR</strong>', 'batch.log')</code><br>
                            <small style="color: #666;">Directory â†’ /u01/app/logs/</small>
                        </td>
                        <td style="padding: 12px; border: 1px solid #ddd;">
                            Fichier stockÃ© dans : <code>bucket/<strong>LOG_DIR</strong>/batch.log</code>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd;">
                            <code>UTL_FILE.FOPEN('<strong>REPORTS</strong>', 'rapport.pdf')</code><br>
                            <small style="color: #666;">Directory â†’ /u01/app/reports/</small>
                        </td>
                        <td style="padding: 12px; border: 1px solid #ddd;">
                            Fichier stockÃ© dans : <code>bucket/<strong>REPORTS</strong>/rapport.pdf</code>
                        </td>
                    </tr>
                </tbody>
            </table>
            <p style="margin: 0; text-align: center; font-style: italic; color: #1565c0;">
                <strong>Le nom du directory Oracle devient le nom du dossier dans le bucket !</strong>
            </p>
        </div>

        <h3>ğŸ” Script : Lister tous les directories utilisÃ©s par ton code</h3>

        <div class="code-container">
            <div class="code-header">
                <span>SQL - Identifier les directories Ã  crÃ©er dans Object Storage</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- ============================================
-- IDENTIFIER LES DIRECTORIES Ã€ CRÃ‰ER DANS LE BUCKET
-- ============================================
-- Ce script liste tous les directories Oracle utilisÃ©s par UTL_FILE
-- Ces noms doivent Ãªtre crÃ©Ã©s comme dossiers (prefixes) dans Object Storage

-- Afficher le schÃ©ma courant
SELECT USER AS schema_courant FROM DUAL;

-- MÃ‰THODE 1 : Directories rÃ©fÃ©rencÃ©s dans le code UTL_FILE du schÃ©ma courant
-- --------------------------------------------------------------------------
SELECT DISTINCT
    REGEXP_SUBSTR(text, '''([A-Z_0-9]+)''', 1, 1, 'i', 1) AS directory_utilise
FROM user_source
WHERE UPPER(text) LIKE '%UTL_FILE.FOPEN%'
  AND REGEXP_SUBSTR(text, '''([A-Z_0-9]+)''', 1, 1, 'i', 1) IS NOT NULL
ORDER BY 1;


-- MÃ‰THODE 2 : Directories avec leurs chemins actuels (vue DBA)
-- ------------------------------------------------------------
-- Montre aussi le chemin physique actuel (pour info)
SELECT DISTINCT
    d.directory_name AS "Directory Oracle",
    d.directory_path AS "Chemin actuel (On-Premise)",
    d.directory_name AS "Dossier Ã  crÃ©er dans bucket"
FROM dba_directories d
WHERE d.directory_name IN (
    SELECT DISTINCT
        REGEXP_SUBSTR(text, '''([A-Z_0-9]+)''', 1, 1, 'i', 1)
    FROM dba_source
    WHERE UPPER(text) LIKE '%UTL_FILE.FOPEN%'
)
ORDER BY d.directory_name;


-- MÃ‰THODE 3 : Rapport complet pour l'email aux admins OCI
-- -------------------------------------------------------
-- GÃ©nÃ¨re une liste formatÃ©e Ã  copier dans l'email
SELECT
    '   - ' || d.directory_name || '/' AS "Dossiers Ã  crÃ©er dans le bucket"
FROM dba_directories d
WHERE d.directory_name IN (
    SELECT DISTINCT
        REGEXP_SUBSTR(text, '''([A-Z_0-9]+)''', 1, 1, 'i', 1)
    FROM dba_source
    WHERE UPPER(text) LIKE '%UTL_FILE.FOPEN%'
)
ORDER BY d.directory_name;


-- MÃ‰THODE 4 : Compter les fichiers par directory (estimation usage)
-- -----------------------------------------------------------------
-- Permet de prioriser les directories les plus utilisÃ©s
SELECT
    REGEXP_SUBSTR(text, '''([A-Z_0-9]+)''', 1, 1, 'i', 1) AS directory_name,
    COUNT(*) AS nb_utilisations
FROM dba_source
WHERE UPPER(text) LIKE '%UTL_FILE.FOPEN%'
  AND REGEXP_SUBSTR(text, '''([A-Z_0-9]+)''', 1, 1, 'i', 1) IS NOT NULL
GROUP BY REGEXP_SUBSTR(text, '''([A-Z_0-9]+)''', 1, 1, 'i', 1)
ORDER BY nb_utilisations DESC;</code></pre>
        </div>

        <h3>ğŸ“§ Exemple de liste Ã  envoyer aux admins OCI</h3>

        <div style="background: #f8f9fa; border: 2px dashed #6c757d; border-radius: 10px; padding: 20px; margin: 20px 0; font-family: 'Courier New', monospace;">
            <p style="margin: 0 0 15px 0; font-weight: bold; color: #495057;">Dossiers (prefixes) Ã  crÃ©er dans le bucket Object Storage :</p>
            <pre style="background: transparent; margin: 0; padding: 0; color: #212529;">
   - DATA_EXPORT/
   - LOG_DIR/
   - REPORTS/
   - BACKUP_DIR/
   - INTERFACE_IN/
   - INTERFACE_OUT/
   [Adapter selon le rÃ©sultat de ton audit]</pre>
        </div>

        <div class="alert alert-success">
            <span class="alert-icon">âœ…</span>
            <div>
                <strong>RÃ©sultat attendu</strong><br>
                AprÃ¨s crÃ©ation par les admins OCI, le bucket aura cette structure :
                <pre style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; margin-top: 10px;">
mon-bucket/
â”œâ”€â”€ DATA_EXPORT/
â”‚   â””â”€â”€ (tes fichiers d'export iront ici)
â”œâ”€â”€ LOG_DIR/
â”‚   â””â”€â”€ (tes logs iront ici)
â”œâ”€â”€ REPORTS/
â”‚   â””â”€â”€ (tes rapports iront ici)
â””â”€â”€ ...</pre>
            </div>
        </div>

        <div class="alert alert-warning">
            <span class="alert-icon">âš ï¸</span>
            <div>
                <strong>Important</strong><br>
                Les noms des dossiers dans Object Storage doivent Ãªtre <strong>exactement identiques</strong> aux noms des directories Oracle (en majuscules gÃ©nÃ©ralement). Sinon la table de mapping ne fera pas la correspondance !
            </div>
        </div>

    </section>

    <!-- Ton plan d'action -->
    <section>
        <h2>ğŸ“‹ Ton Plan d'Action (5 Ã©tapes)</h2>

        <div class="progress-bar">
            <div class="progress-fill" style="width: 20%;" id="progress"></div>
        </div>
        <p style="text-align: center; color: var(--gray);">Progression : <span id="progress-text">Ã‰tape 1/5</span></p>

        <ul class="checklist">
            <!-- Ã‰TAPE 1 -->
            <li class="pending">
                <span class="step-number">1</span>
                <div>
                    <strong>Audit UTL_FILE</strong> <span class="tag tag-toi">Ã€ faire maintenant</span><br>
                    <small>Identifier toutes les utilisations de UTL_FILE dans la base. Tu peux commencer sans attendre les admins OCI.</small>
                </div>
            </li>
        </ul>
        <div class="alert alert-info" style="margin: 0 0 20px 45px;">
            <span class="alert-icon">ğŸ’¡</span>
            <div>
                <strong>Pourquoi cette Ã©tape ?</strong><br>
                <p style="margin: 10px 0;">Imagine que tu dÃ©mÃ©nages d'une maison vers un appartement. Avant de commencer, tu dois <strong>inventorier tout ce que tu possÃ¨des</strong> pour savoir ce qui rentrera et ce qu'il faudra adapter.</p>
                <p style="margin: 10px 0;">C'est pareil ici : UTL_FILE c'est ton "ancienne mÃ©thode" pour lire/Ã©crire des fichiers sur le serveur. Sur ExaCC, cette mÃ©thode ne fonctionne plus. Tu dois donc <strong>lister tous les endroits du code</strong> oÃ¹ cette mÃ©thode est utilisÃ©e pour savoir exactement ce qu'il faudra modifier.</p>
                <p style="margin: 10px 0;"><strong>Analogie :</strong> C'est comme faire le tour de ta maison avec un carnet pour noter tous les meubles avant le dÃ©mÃ©nagement.</p>
            </div>
        </div>

        <ul class="checklist">
            <!-- Ã‰TAPE 2 -->
            <li class="blocked">
                <span class="step-number">2</span>
                <div>
                    <strong>Envoyer l'email aux admins OCI</strong> <span class="tag tag-attente">Bloquant</span><br>
                    <small>Demander : URI bucket, nom du credential, confirmation ACL.</small>
                </div>
            </li>
        </ul>
        <div class="alert alert-info" style="margin: 0 0 20px 45px;">
            <span class="alert-icon">ğŸ’¡</span>
            <div>
                <strong>Pourquoi cette Ã©tape ?</strong><br>
                <p style="margin: 10px 0;">Tu as besoin de <strong>3 informations clÃ©s</strong> que seuls les admins OCI peuvent te donner :</p>
                <ul style="margin: 10px 0 10px 20px;">
                    <li><strong>URI du bucket</strong> = l'adresse du nouveau "disque dur cloud" oÃ¹ seront stockÃ©s tes fichiers</li>
                    <li><strong>Credential</strong> = le "mot de passe" que la base utilisera pour accÃ©der Ã  ce disque cloud</li>
                    <li><strong>ACL</strong> = l'autorisation rÃ©seau pour que ta base puisse communiquer avec le cloud</li>
                </ul>
                <p style="margin: 10px 0;"><strong>Analogie :</strong> C'est comme demander Ã  ton nouveau propriÃ©taire l'adresse exacte, les clÃ©s et le code du digicode avant de dÃ©mÃ©nager.</p>
            </div>
        </div>

        <ul class="checklist">
            <!-- Ã‰TAPE 3 -->
            <li class="blocked">
                <span class="step-number">3</span>
                <div>
                    <strong>CrÃ©er la table de mapping</strong> <span class="tag tag-attente">Attente retour admins</span><br>
                    <small>AprÃ¨s rÃ©ception de l'URI du bucket, crÃ©er la table de correspondance directory â†’ Object Storage.</small>
                </div>
            </li>
        </ul>
        <div class="alert alert-info" style="margin: 0 0 20px 45px;">
            <span class="alert-icon">ğŸ’¡</span>
            <div>
                <strong>Pourquoi cette Ã©tape ?</strong><br>
                <p style="margin: 10px 0;">Ton ancien code utilise des <strong>"directories Oracle"</strong> comme <code>DATA_EXPORT</code> ou <code>LOG_DIR</code>. Ce sont des raccourcis vers des dossiers sur le serveur (ex: <code>/u01/app/data</code>).</p>
                <p style="margin: 10px 0;">Sur ExaCC, ces dossiers n'existent plus. La table de mapping fait la <strong>traduction</strong> entre l'ancien chemin et le nouveau chemin cloud :</p>
                <table style="margin: 10px 0; font-size: 0.9rem;">
                    <tr><td style="padding: 5px 10px; background: #fce8e6;"><code>DATA_EXPORT</code></td><td style="padding: 5px;">â†’</td><td style="padding: 5px 10px; background: #e6f4ea;"><code>https://objectstorage.../DATA_EXPORT/</code></td></tr>
                    <tr><td style="padding: 5px 10px; background: #fce8e6;"><code>LOG_DIR</code></td><td style="padding: 5px;">â†’</td><td style="padding: 5px 10px; background: #e6f4ea;"><code>https://objectstorage.../LOG_DIR/</code></td></tr>
                </table>
                <p style="margin: 10px 0;"><strong>Analogie :</strong> C'est comme crÃ©er un tableau de correspondance "ancienne adresse â†’ nouvelle adresse" pour faire suivre ton courrier aprÃ¨s un dÃ©mÃ©nagement.</p>
            </div>
        </div>

        <ul class="checklist">
            <!-- Ã‰TAPE 4 -->
            <li class="blocked">
                <span class="step-number">4</span>
                <div>
                    <strong>DÃ©ployer le package wrapper</strong> <span class="tag tag-attente">Attente retour admins</span><br>
                    <small>Installer UTL_FILE_WRAPPER qui utilise DBMS_CLOUD en arriÃ¨re-plan.</small>
                </div>
            </li>
        </ul>
        <div class="alert alert-info" style="margin: 0 0 20px 45px;">
            <span class="alert-icon">ğŸ’¡</span>
            <div>
                <strong>Pourquoi cette Ã©tape ?</strong><br>
                <p style="margin: 10px 0;">Le <strong>wrapper</strong> est un "traducteur" intelligent. Il permet Ã  ton ancien code de continuer Ã  fonctionner <strong>sans le modifier</strong>.</p>
                <p style="margin: 10px 0;"><strong>Comment Ã§a marche :</strong></p>
                <ul style="margin: 10px 0 10px 20px;">
                    <li>Ton code appelle <code>UTL_FILE.FOPEN('DATA_EXPORT', 'fichier.txt')</code> comme avant</li>
                    <li>Le wrapper intercepte cet appel</li>
                    <li>Il consulte la table de mapping pour trouver l'URL cloud correspondante</li>
                    <li>Il utilise <code>DBMS_CLOUD</code> pour envoyer le fichier vers Object Storage</li>
                    <li>Ton code ne voit aucune diffÃ©rence !</li>
                </ul>
                <p style="margin: 10px 0;"><strong>Analogie :</strong> C'est comme un adaptateur Ã©lectrique quand tu voyages. Ta prise franÃ§aise fonctionne toujours, l'adaptateur fait la conversion vers la prise Ã©trangÃ¨re.</p>
            </div>
        </div>

        <ul class="checklist">
            <!-- Ã‰TAPE 5 -->
            <li class="blocked">
                <span class="step-number">5</span>
                <div>
                    <strong>CrÃ©er le synonyme et tester</strong> <span class="tag tag-attente">AprÃ¨s Ã©tape 4</span><br>
                    <small>CrÃ©er le synonyme UTL_FILE â†’ UTL_FILE_WRAPPER et valider avec un test complet.</small>
                </div>
            </li>
        </ul>
        <div class="alert alert-info" style="margin: 0 0 20px 45px;">
            <span class="alert-icon">ğŸ’¡</span>
            <div>
                <strong>Pourquoi cette Ã©tape ?</strong><br>
                <p style="margin: 10px 0;">C'est le moment de <strong>brancher l'adaptateur</strong> avec le <strong>synonyme</strong> :</p>
                <ul style="margin: 10px 0 10px 20px;">
                    <li>Tu crÃ©es un "alias" : quand le code dit <code>UTL_FILE</code>, Oracle comprend <code>UTL_FILE_WRAPPER</code></li>
                    <li>Avantage : <strong>zÃ©ro modification</strong> de ton code existant</li>
                    <li>Avec 1000+ utilisations, c'est la seule mÃ©thode viable et sans risque</li>
                </ul>
                <p style="margin: 10px 0;">Ensuite, tu <strong>testes</strong> que tout fonctionne : Ã©criture d'un fichier test, lecture, suppression. Si Ã§a marche, la migration est terminÃ©e !</p>
                <p style="margin: 10px 0;"><strong>Analogie :</strong> C'est comme tester l'Ã©lectricitÃ© dans ton nouvel appartement aprÃ¨s avoir tout branchÃ©.</p>
            </div>
        </div>

    </section>

    <!-- Architecture et Flux -->
    <section>
        <h2>ğŸ—ï¸ Comprendre l'Architecture : Avant / AprÃ¨s</h2>

        <div class="alert alert-info">
            <span class="alert-icon">ğŸ“</span>
            <div>
                <strong>Ton contexte : Migration On-Premise â†’ ExaCC</strong><br>
                Ta base de donnÃ©es est actuellement sur un serveur physique (On-Premise) et va Ãªtre migrÃ©e vers ExaCC dans le cloud OCI.
            </div>
        </div>

        <!-- AVANT : On-Premise -->
        <h3>ğŸ  AVANT : Comment Ã§a marche aujourd'hui (On-Premise)</h3>

        <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #ff9800;">
            <pre style="background: transparent; color: #333; font-family: 'Courier New', monospace; font-size: 0.95rem; line-height: 1.8; margin: 0; overflow-x: auto;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ğŸ¢ TON SERVEUR ACTUEL (On-Premise)             â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚   â”‚  ğŸ“ Code PL/SQL â”‚                                           â”‚
â”‚   â”‚                 â”‚                                           â”‚
â”‚   â”‚  UTL_FILE.FOPEN â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚   â”‚  ('DATA_EXPORT',â”‚         â”‚                                 â”‚
â”‚   â”‚   'fichier.txt')â”‚         â”‚  AccÃ¨s DIRECT au disque         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                                 â”‚
â”‚                               â–¼                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚              â”‚  ğŸ’¾ DISQUE DUR DU SERVEUR          â”‚             â”‚
â”‚              â”‚                                    â”‚             â”‚
â”‚              â”‚  ğŸ“ /u01/app/oracle/data/          â”‚             â”‚
â”‚              â”‚     â”œâ”€â”€ ğŸ“„ export_20240115.csv     â”‚             â”‚
â”‚              â”‚     â”œâ”€â”€ ğŸ“„ rapport_mensuel.txt     â”‚             â”‚
â”‚              â”‚     â””â”€â”€ ğŸ“„ log_batch.txt           â”‚             â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 10px;">
                <strong>ğŸ’¡ Explication simple :</strong>
                <p style="margin: 10px 0;">Aujourd'hui, quand ton code fait <code>UTL_FILE.FOPEN('DATA_EXPORT', 'fichier.txt')</code>, Oracle va directement Ã©crire sur le disque dur du serveur, dans un dossier comme <code>/u01/app/oracle/data/</code>.</p>
                <p style="margin: 5px 0;"><strong>Analogie :</strong> C'est comme Ã©crire un document et le sauvegarder sur le disque dur de ton PC. Simple et direct.</p>
            </div>
        </div>

        <!-- APRÃˆS : ExaCC -->
        <h3>â˜ï¸ APRÃˆS : Comment Ã§a marchera sur ExaCC</h3>

        <!-- Pourquoi migrer vers ExaCC -->
        <div style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #9c27b0;">
            <h4 style="margin-top: 0; color: #6a1b9a;">ğŸ¯ Pourquoi migrer vers ExaCC ?</h4>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                <div style="background: white; border-radius: 10px; padding: 15px; border-left: 4px solid #4caf50;">
                    <strong style="color: #2e7d32;">ğŸ’° RÃ©duction des coÃ»ts</strong>
                    <p style="margin: 10px 0 0 0; font-size: 0.9rem;">Plus besoin de gÃ©rer le matÃ©riel, la climatisation, l'Ã©lectricitÃ© du datacenter. Oracle s'en occupe.</p>
                </div>
                <div style="background: white; border-radius: 10px; padding: 15px; border-left: 4px solid #2196f3;">
                    <strong style="color: #1565c0;">ğŸ”§ Maintenance simplifiÃ©e</strong>
                    <p style="margin: 10px 0 0 0; font-size: 0.9rem;">Les patchs, mises Ã  jour et maintenance matÃ©rielle sont gÃ©rÃ©s par Oracle. Tu te concentres sur la base.</p>
                </div>
                <div style="background: white; border-radius: 10px; padding: 15px; border-left: 4px solid #ff9800;">
                    <strong style="color: #e65100;">ğŸ“ˆ ScalabilitÃ©</strong>
                    <p style="margin: 10px 0 0 0; font-size: 0.9rem;">Besoin de plus de puissance ? Tu augmentes les ressources en quelques clics, sans acheter de nouveau serveur.</p>
                </div>
                <div style="background: white; border-radius: 10px; padding: 15px; border-left: 4px solid #f44336;">
                    <strong style="color: #c62828;">ğŸ›¡ï¸ Haute disponibilitÃ©</strong>
                    <p style="margin: 10px 0 0 0; font-size: 0.9rem;">RÃ©plication automatique, backups gÃ©rÃ©s par Oracle, reprise aprÃ¨s sinistre facilitÃ©e.</p>
                </div>
                <div style="background: white; border-radius: 10px; padding: 15px; border-left: 4px solid #9c27b0;">
                    <strong style="color: #6a1b9a;">ğŸ”’ SÃ©curitÃ© renforcÃ©e</strong>
                    <p style="margin: 10px 0 0 0; font-size: 0.9rem;">Chiffrement automatique, isolation rÃ©seau, conformitÃ© aux normes (RGPD, etc.).</p>
                </div>
                <div style="background: white; border-radius: 10px; padding: 15px; border-left: 4px solid #00bcd4;">
                    <strong style="color: #00838f;">ğŸ  DonnÃ©es chez toi</strong>
                    <p style="margin: 10px 0 0 0; font-size: 0.9rem;">Avec ExaCC, l'infrastructure est dans TON datacenter. Tu gardes le contrÃ´le physique de tes donnÃ©es.</p>
                </div>
            </div>
        </div>

        <!-- DiffÃ©rence On-Premise vs ExaCC -->
        <div style="background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #ffc107;">
            <h4 style="margin-top: 0; color: #f57f17;">ğŸ†š Oracle On-Premise vs ExaCC : Quelle diffÃ©rence ?</h4>

            <table style="width: 100%; margin: 15px 0; background: white; border-radius: 10px; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="background: #f57f17; color: white; padding: 15px; text-align: left; width: 25%;">CritÃ¨re</th>
                        <th style="background: #ff8f00; color: white; padding: 15px; text-align: center;">Oracle On-Premise (Actuel)</th>
                        <th style="background: #4caf50; color: white; padding: 15px; text-align: center;">ExaCC (Cible)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">ğŸ–¥ï¸ Infrastructure</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">Serveurs Linux classiques<br><small style="color: #666;">Tu installes Oracle dessus</small></td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; background: #e8f5e9;">Exadata (appliance optimisÃ©e)<br><small style="color: #666;">MatÃ©riel + logiciel intÃ©grÃ©</small></td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">ğŸ“ OÃ¹ est le matÃ©riel ?</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">Dans ton datacenter<br><small style="color: #666;">Tu achÃ¨tes et gÃ¨res tout</small></td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; background: #e8f5e9;">Dans ton datacenter<br><small style="color: #666;">Oracle installe et gÃ¨re</small></td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">ğŸ’µ ModÃ¨le de coÃ»t</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">CAPEX (achat serveurs + licences)<br><small style="color: #666;">Investissement initial</small></td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; background: #e8f5e9;">OPEX (abonnement)<br><small style="color: #666;">Paiement mensuel/annuel</small></td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">ğŸ”§ Qui gÃ¨re quoi ?</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">Toi : serveurs, OS, Oracle, patchs<br><small style="color: #666;">Charge opÃ©rationnelle Ã©levÃ©e</small></td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; background: #e8f5e9;">Oracle : matÃ©riel, OS, patchs<br>Toi : bases de donnÃ©es uniquement</td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">âš¡ Performance</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">DÃ©pend de ton matÃ©riel<br><small style="color: #666;">Variable selon config</small></td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; background: #e8f5e9;">OptimisÃ©e pour Oracle<br><small style="color: #666;">Smart Scan, InfiniBand, etc.</small></td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">ğŸ“ AccÃ¨s filesystem</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; background: #e8f5e9;">OUI (UTL_FILE)<br><small style="color: #666;">AccÃ¨s direct /u01/...</small></td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; background: #ffebee;">NON âŒ<br><small style="color: #c62828;">â†’ Object Storage + DBMS_CLOUD</small></td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">â˜ï¸ Services cloud OCI</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">Non disponible<br><small style="color: #666;">IsolÃ© du cloud</small></td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; background: #e8f5e9;">IntÃ©grÃ© nativement<br><small style="color: #666;">Object Storage, IAM, backups...</small></td>
                    </tr>
                </tbody>
            </table>

            <div style="background: white; border-radius: 10px; padding: 20px; margin-top: 15px; border-left: 5px solid #f57f17;">
                <strong>ğŸ’¡ En rÃ©sumÃ© simple (pour expliquer comme un pro) :</strong>

                <div style="margin: 15px 0; padding: 15px; background: #fff3e0; border-radius: 10px;">
                    <p style="margin: 0 0 10px 0;"><strong>ğŸ§ Actuellement : Oracle sur serveurs Linux On-Premise</strong></p>
                    <p style="margin: 0; padding-left: 15px;">
                        Vos bases Oracle sont installÃ©es sur des <strong>serveurs Linux classiques</strong> dans votre datacenter.
                        Vous gÃ©rez tout : le matÃ©riel (serveurs, stockage, rÃ©seau), le systÃ¨me d'exploitation Linux,
                        l'installation d'Oracle, les patchs de sÃ©curitÃ©, les sauvegardes, etc.
                        C'est un modÃ¨le <strong>CAPEX</strong> (investissement) avec un contrÃ´le total mais une <strong>charge opÃ©rationnelle importante</strong>.
                    </p>
                </div>

                <div style="margin: 15px 0; padding: 15px; background: #e8f5e9; border-radius: 10px;">
                    <p style="margin: 0 0 10px 0;"><strong>â˜ï¸ Cible : ExaCC (Exadata Cloud@Customer)</strong></p>
                    <p style="margin: 0; padding-left: 15px;">
                        <strong>Exadata</strong> est une appliance Oracle : du matÃ©riel spÃ©cialement conÃ§u et optimisÃ© pour faire tourner Oracle Database
                        (stockage flash, rÃ©seau InfiniBand, Smart Scan, etc.). C'est la <strong>Rolls-Royce des infrastructures Oracle</strong>.<br><br>
                        <strong>Cloud@Customer</strong> signifie qu'Oracle installe cette Exadata <strong>physiquement dans votre datacenter</strong>,
                        mais c'est <strong>Oracle qui la gÃ¨re</strong> (maintenance, patchs, monitoring matÃ©riel).<br><br>
                        Vous passez en modÃ¨le <strong>OPEX</strong> (abonnement) et vous vous concentrez uniquement sur vos <strong>bases de donnÃ©es</strong> (schÃ©mas, donnÃ©es, PL/SQL).
                        Vos donnÃ©es restent chez vous = <strong>souverainetÃ© des donnÃ©es</strong> garantie.
                    </p>
                </div>

                <div style="margin: 15px 0; padding: 15px; background: #e3f2fd; border-radius: 10px;">
                    <p style="margin: 0 0 10px 0;"><strong>ğŸ¯ La diffÃ©rence clÃ© en une phrase :</strong></p>
                    <p style="margin: 0; padding-left: 15px; font-size: 1.05rem;">
                        <em>"On passe de <strong>serveurs Linux classiques qu'on gÃ¨re nous-mÃªmes</strong> Ã  une <strong>infrastructure Exadata managÃ©e par Oracle</strong>,
                        installÃ©e chez nous. On gagne en performance, en fiabilitÃ© et on rÃ©duit notre charge opÃ©rationnelle,
                        tout en gardant nos donnÃ©es dans notre datacenter."</em>
                    </p>
                </div>

                <div style="margin: 15px 0; padding: 15px; background: #fce4ec; border-radius: 10px; border: 2px solid #e91e63;">
                    <p style="margin: 0 0 10px 0;"><strong>âš ï¸ Impact technique majeur pour le DBA :</strong></p>
                    <p style="margin: 0; padding-left: 15px;">
                        Sur ExaCC, tu n'as <strong>plus d'accÃ¨s au filesystem</strong> du serveur (pas de SSH sur /u01/app/...).
                        Les packages comme <code>UTL_FILE</code> qui Ã©crivent sur le disque local ne fonctionnent plus.<br><br>
                        Tu dois utiliser <strong>Object Storage</strong> (stockage objet OCI) via le package <strong>DBMS_CLOUD</strong> pour toutes les opÃ©rations fichiers.
                        <br><br>
                        <strong>ğŸ‘‰ C'est exactement l'objet de cette migration :</strong> adapter ton code PL/SQL pour qu'il fonctionne sur ExaCC.
                    </p>
                </div>

                <div style="margin: 15px 0; padding: 15px; background: #f5f5f5; border-radius: 10px; border: 1px solid #9e9e9e;">
                    <p style="margin: 0 0 10px 0;"><strong>ğŸ“ Script pour expliquer Ã  un collÃ¨gue ou manager :</strong></p>
                    <p style="margin: 0; padding: 10px; background: white; border-radius: 8px; font-style: italic; line-height: 1.8;">
                        "Actuellement, nos bases Oracle tournent sur des <strong>serveurs Linux classiques</strong> qu'on gÃ¨re nous-mÃªmes (matÃ©riel, OS, patchs, etc.).<br><br>
                        On migre vers <strong>ExaCC (Exadata Cloud@Customer)</strong>. C'est une infrastructure <strong>Exadata</strong> â€” du matÃ©riel haute performance spÃ©cialement conÃ§u pour Oracle â€” qu'Oracle va installer <strong>dans notre datacenter</strong>. Mais c'est <strong>Oracle qui gÃ¨re l'infrastructure</strong> (maintenance, patchs, monitoring). Nous, on se concentre uniquement sur nos bases de donnÃ©es.<br><br>
                        <strong>Les avantages :</strong> meilleures performances, moins de charge opÃ©rationnelle, modÃ¨le OPEX (abonnement au lieu d'achat), services cloud OCI intÃ©grÃ©s, et nos donnÃ©es restent physiquement chez nous.<br><br>
                        <strong>La contrainte technique :</strong> on perd l'accÃ¨s direct au filesystem du serveur. Donc tout notre code qui utilise <strong>UTL_FILE</strong> pour lire/Ã©crire des fichiers doit Ãªtre adaptÃ© pour utiliser <strong>Object Storage</strong> via <strong>DBMS_CLOUD</strong>. C'est l'objet de ce projet de migration."
                    </p>
                </div>
            </div>
        </div>

        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border: 2px solid #2196f3;">
            <pre style="background: transparent; color: #333; font-family: 'Courier New', monospace; font-size: 0.85rem; line-height: 1.6; margin: 0; overflow-x: auto;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â˜ï¸ CLOUD OCI                                          â”‚
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         ğŸ—„ï¸ ExaCC (ta base de donnÃ©es)       â”‚     â”‚    ğŸ“¦ Object Storage (Bucket)  â”‚  â”‚
â”‚  â”‚                                             â”‚     â”‚                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚     â”‚    C'est ton nouveau           â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ“ Code PL/SQL â”‚                        â”‚     â”‚    "disque dur cloud"          â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚                        â”‚     â”‚                                â”‚  â”‚
â”‚  â”‚  â”‚  UTL_FILE.FOPEN â”‚ â—„â”€â”€ Ton code ne       â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  ('DATA_EXPORT',â”‚     change PAS !       â”‚     â”‚  â”‚ ğŸ“ DATA_EXPORT/          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   'fichier.txt')â”‚                        â”‚     â”‚  â”‚    ğŸ“„ fichier.txt        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚     â”‚  â”‚    ğŸ“„ export.csv         â”‚  â”‚  â”‚
â”‚  â”‚           â”‚                                 â”‚     â”‚  â”‚                          â”‚  â”‚  â”‚
â”‚  â”‚           â–¼                                 â”‚     â”‚  â”‚ ğŸ“ LOG_DIR/              â”‚  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚     â”‚  â”‚    ğŸ“„ batch.log          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ”„ SYNONYME     â”‚  "Quand tu dis         â”‚     â”‚  â”‚                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ UTL_FILE =      â”‚   UTL_FILE, je         â”‚     â”‚  â”‚ ğŸ“ REPORTS/              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ UTL_FILE_WRAPPERâ”‚   comprends WRAPPER"   â”‚     â”‚  â”‚    ğŸ“„ rapport.pdf        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚           â”‚                                 â”‚     â”‚               â–²                â”‚  â”‚
â”‚  â”‚           â–¼                                 â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“¦ WRAPPER      â”‚  Le traducteur !       â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ UTL_FILE_WRAPPERâ”‚                        â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚           â”‚                                 â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚           â–¼                                 â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“‹ TABLE MAPPINGâ”‚  "DATA_EXPORT" =       â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ directory â†’ URL â”‚  https://object...     â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚           â”‚                                 â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚           â–¼                                 â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTPS (port 443)    â”‚     â”‚               â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ”Œ DBMS_CLOUD   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                â”‚  â”‚
â”‚  â”‚  â”‚ (package Oracle)â”‚    + CREDENTIAL        â”‚     â”‚                                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    (authentification)  â”‚     â”‚                                â”‚  â”‚
â”‚  â”‚                                             â”‚     â”‚                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                          â”‚
â”‚         â–²                                                        â–²                       â”‚
â”‚         â”‚                    ğŸ”’ ACL (Firewall interne)           â”‚                       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ autorise la connexion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
        </div>

        <!-- Explication du flux -->
        <h3>ğŸ”„ Le Flux ExpliquÃ© Pas Ã  Pas</h3>

        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin: 20px 0;">
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td style="width: 60px; text-align: center; vertical-align: top; padding: 15px;">
                        <span style="background: #4caf50; color: white; border-radius: 50%; width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">1</span>
                    </td>
                    <td style="padding: 15px; border-bottom: 1px solid #e0e0e0;">
                        <strong>Ton code appelle UTL_FILE</strong><br>
                        <code style="background: #fff3e0; padding: 5px 10px; border-radius: 5px;">UTL_FILE.FOPEN('DATA_EXPORT', 'rapport.txt', 'W')</code><br>
                        <small style="color: #666;">ğŸ‘‰ Ton code PL/SQL n'a pas changÃ©, il utilise toujours UTL_FILE comme avant !</small>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center; vertical-align: top; padding: 15px;">
                        <span style="background: #2196f3; color: white; border-radius: 50%; width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">2</span>
                    </td>
                    <td style="padding: 15px; border-bottom: 1px solid #e0e0e0;">
                        <strong>Le SYNONYME redirige vers le WRAPPER</strong><br>
                        <small style="color: #666;">ğŸ‘‰ Oracle dit : "UTL_FILE ? Je connais pas, mais j'ai un synonyme qui me dit d'utiliser UTL_FILE_WRAPPER Ã  la place !"</small><br>
                        <span style="background: #e3f2fd; padding: 5px 10px; border-radius: 5px; display: inline-block; margin-top: 5px;">UTL_FILE â†’ UTL_FILE_WRAPPER (automatique, invisible)</span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center; vertical-align: top; padding: 15px;">
                        <span style="background: #ff9800; color: white; border-radius: 50%; width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">3</span>
                    </td>
                    <td style="padding: 15px; border-bottom: 1px solid #e0e0e0;">
                        <strong>Le WRAPPER consulte la TABLE DE MAPPING</strong><br>
                        <small style="color: #666;">ğŸ‘‰ Le wrapper cherche : "DATA_EXPORT, c'est quoi en URL cloud ?"</small><br>
                        <table style="margin: 10px 0; font-size: 0.9rem; background: white;">
                            <tr style="background: #ffecb3;"><td style="padding: 8px;"><code>DATA_EXPORT</code></td><td style="padding: 8px;">â†’</td><td style="padding: 8px;"><code>https://objectstorage.eu-paris-1.oraclecloud.com/.../DATA_EXPORT/</code></td></tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center; vertical-align: top; padding: 15px;">
                        <span style="background: #9c27b0; color: white; border-radius: 50%; width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">4</span>
                    </td>
                    <td style="padding: 15px; border-bottom: 1px solid #e0e0e0;">
                        <strong>Le WRAPPER appelle DBMS_CLOUD avec le CREDENTIAL</strong><br>
                        <small style="color: #666;">ğŸ‘‰ Le wrapper dit Ã  DBMS_CLOUD : "Envoie ce fichier Ã  cette URL, voici le mot de passe (credential)"</small><br>
                        <code style="background: #f3e5f5; padding: 5px 10px; border-radius: 5px; display: inline-block; margin-top: 5px;">DBMS_CLOUD.PUT_OBJECT(credential_name => 'MON_CREDENTIAL', ...)</code>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center; vertical-align: top; padding: 15px;">
                        <span style="background: #f44336; color: white; border-radius: 50%; width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">5</span>
                    </td>
                    <td style="padding: 15px; border-bottom: 1px solid #e0e0e0;">
                        <strong>L'ACL autorise la connexion rÃ©seau</strong><br>
                        <small style="color: #666;">ğŸ‘‰ Le firewall interne OCI vÃ©rifie : "ExaCC a-t-il le droit de parler Ã  Object Storage ?" â†’ OUI</small><br>
                        <span style="background: #ffebee; padding: 5px 10px; border-radius: 5px; display: inline-block; margin-top: 5px;">ğŸ”’ C'est une rÃ¨gle de sÃ©curitÃ© INTERNE au cloud (pas Internet)</span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center; vertical-align: top; padding: 15px;">
                        <span style="background: #4caf50; color: white; border-radius: 50%; width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">âœ“</span>
                    </td>
                    <td style="padding: 15px;">
                        <strong>Le fichier arrive dans Object Storage !</strong><br>
                        <small style="color: #666;">ğŸ‘‰ Ton fichier <code>rapport.txt</code> est maintenant stockÃ© dans le bucket, accessible via URL</small><br>
                        <code style="background: #e8f5e9; padding: 5px 10px; border-radius: 5px; display: inline-block; margin-top: 5px;">https://objectstorage.../DATA_EXPORT/rapport.txt</code>
                    </td>
                </tr>
            </table>
        </div>

        <!-- C'est quoi l'ACL -->
        <h3>ğŸ”’ C'est quoi l'ACL exactement ?</h3>

        <div class="alert alert-warning" style="margin: 20px 0;">
            <span class="alert-icon">ğŸ”</span>
            <div>
                <strong>ACL = Access Control List (Liste de ContrÃ´le d'AccÃ¨s)</strong>
                <p style="margin: 10px 0;">MÃªme si ta base ExaCC et Object Storage sont <strong>tous les deux dans le cloud OCI</strong>, ils ne peuvent pas se parler automatiquement. C'est une mesure de sÃ©curitÃ©.</p>
                <p style="margin: 10px 0;">L'ACL est une rÃ¨gle qui dit : <em>"La base de donnÃ©es ExaCC a le droit de se connecter Ã  Object Storage sur le port 443 (HTTPS)"</em></p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div style="background: #ffebee; border-radius: 10px; padding: 20px; border-left: 5px solid #f44336;">
                <h4 style="margin: 0 0 10px 0; color: #c62828;">âŒ Sans ACL configurÃ©e</h4>
                <p style="margin: 0; font-size: 0.95rem;">Ta base essaie d'accÃ©der Ã  Object Storage â†’ <strong>BLOQUÃ‰</strong> par le firewall interne OCI</p>
                <p style="margin: 10px 0 0 0; font-size: 0.85rem; color: #666;">Erreur : <code>ORA-29024: Certificate validation failure</code> ou timeout</p>
            </div>
            <div style="background: #e8f5e9; border-radius: 10px; padding: 20px; border-left: 5px solid #4caf50;">
                <h4 style="margin: 0 0 10px 0; color: #2e7d32;">âœ… Avec ACL configurÃ©e</h4>
                <p style="margin: 0; font-size: 0.95rem;">Ta base accÃ¨de Ã  Object Storage â†’ <strong>AUTORISÃ‰</strong></p>
                <p style="margin: 10px 0 0 0; font-size: 0.85rem; color: #666;">Les fichiers sont lus/Ã©crits normalement</p>
            </div>
        </div>

        <div style="background: #e8f5e9; border-radius: 10px; padding: 20px; margin: 20px 0;">
            <strong>ğŸ¯ Bonne nouvelle pour toi :</strong>
            <p style="margin: 10px 0 0 0;">L'ACL est configurÃ©e par les <strong>admins OCI</strong>, pas par toi. Tu dois juste leur demander de confirmer que c'est fait. Dans ton email, demande simplement : <em>"Pouvez-vous confirmer que l'ACL autorise la base ExaCC Ã  accÃ©der Ã  Object Storage ?"</em></p>
        </div>

        <!-- Analogie finale -->
        <h3>ğŸ  Analogie ComplÃ¨te : Le DÃ©mÃ©nagement</h3>

        <div style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <th style="text-align: left; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 5px;">Ã‰lÃ©ment technique</th>
                    <th style="text-align: left; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 5px;">Analogie du dÃ©mÃ©nagement</th>
                </tr>
                <tr>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);"><strong>On-Premise â†’ ExaCC</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);">Tu dÃ©mÃ©nages de ta maison vers un appartement en rÃ©sidence</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);"><strong>UTL_FILE (ancien)</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);">Tu rangeais tes affaires dans ton garage personnel</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);"><strong>Object Storage (nouveau)</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);">Maintenant tu utilises un garde-meuble sÃ©curisÃ© de la rÃ©sidence</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);"><strong>URI du Bucket</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);">L'adresse du garde-meuble</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);"><strong>Credential</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);">La clÃ©/badge pour ouvrir le garde-meuble</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);"><strong>ACL</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);">Le gardien de la rÃ©sidence qui vÃ©rifie que tu as le droit d'accÃ©der au garde-meuble</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);"><strong>Table de Mapping</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);">Un carnet qui dit "les outils du garage â†’ casier A3 du garde-meuble"</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);"><strong>Wrapper</strong></td>
                    <td style="padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1);">Un assistant qui transporte tes affaires entre l'appart et le garde-meuble automatiquement</td>
                </tr>
                <tr>
                    <td style="padding: 12px;"><strong>Synonyme</strong></td>
                    <td style="padding: 12px;">Tu dis toujours "je range au garage" mais l'assistant comprend "je mets au garde-meuble"</td>
                </tr>
            </table>
        </div>

    </section>

    <!-- Ã‰tape 1 : Audit -->
    <section>
        <h2>ğŸ” Ã‰tape 1 : Audit UTL_FILE (Ã€ faire maintenant)</h2>

        <div class="alert alert-success">
            <span class="alert-icon">â–¶ï¸</span>
            <div>
                <strong>Tu peux commencer tout de suite !</strong><br>
                Cette Ã©tape ne dÃ©pend pas des admins OCI. Lance l'audit pour connaÃ®tre l'ampleur du travail.
            </div>
        </div>

        <h3>1.1 Compter les utilisations</h3>
        <div class="code-container">
            <div class="code-header">
                <span>SQL - Comptage global (schÃ©ma courant)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- ============================================
-- AUDIT POUR LE SCHÃ‰MA COURANT (USER)
-- ============================================
-- ExÃ©cute ce script connectÃ© au schÃ©ma Ã  auditer

-- Afficher le schÃ©ma courant
SELECT USER AS schema_courant FROM DUAL;

-- Nombre total de rÃ©fÃ©rences UTL_FILE dans CE schÃ©ma
SELECT COUNT(*) AS total_references
FROM user_source
WHERE UPPER(text) LIKE '%UTL_FILE%';

-- Nombre d'objets distincts impactÃ©s dans CE schÃ©ma
SELECT COUNT(DISTINCT name) AS objets_impactes
FROM user_source
WHERE UPPER(text) LIKE '%UTL_FILE%';</code></pre>
        </div>

        <h3>1.2 Liste des objets Ã  modifier</h3>
        <div class="code-container">
            <div class="code-header">
                <span>SQL - Liste dÃ©taillÃ©e des objets (schÃ©ma courant)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- Liste des objets utilisant UTL_FILE dans le schÃ©ma courant
SELECT
    USER AS owner,
    name AS object_name,
    type AS object_type,
    COUNT(*) AS nb_references
FROM user_source
WHERE UPPER(text) LIKE '%UTL_FILE%'
GROUP BY name, type
ORDER BY nb_references DESC;</code></pre>
        </div>

        <h3>1.3 Types d'opÃ©rations utilisÃ©es</h3>
        <div class="code-container">
            <div class="code-header">
                <span>SQL - RÃ©partition par type d'opÃ©ration (schÃ©ma courant)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- Quelles fonctions UTL_FILE sont utilisÃ©es dans le schÃ©ma courant ?
SELECT
    CASE
        WHEN UPPER(text) LIKE '%FOPEN%' THEN 'FOPEN (ouverture)'
        WHEN UPPER(text) LIKE '%PUT_LINE%' THEN 'PUT_LINE (Ã©criture ligne)'
        WHEN UPPER(text) LIKE '%GET_LINE%' THEN 'GET_LINE (lecture ligne)'
        WHEN UPPER(text) LIKE '%FCLOSE%' THEN 'FCLOSE (fermeture)'
        WHEN UPPER(text) LIKE '%FFLUSH%' THEN 'FFLUSH (flush)'
        WHEN UPPER(text) LIKE '%FILE_TYPE%' THEN 'FILE_TYPE (dÃ©claration)'
        ELSE 'AUTRE'
    END AS operation,
    COUNT(*) AS nb_occurrences
FROM user_source
WHERE UPPER(text) LIKE '%UTL_FILE%'
GROUP BY
    CASE
        WHEN UPPER(text) LIKE '%FOPEN%' THEN 'FOPEN (ouverture)'
        WHEN UPPER(text) LIKE '%PUT_LINE%' THEN 'PUT_LINE (Ã©criture ligne)'
        WHEN UPPER(text) LIKE '%GET_LINE%' THEN 'GET_LINE (lecture ligne)'
        WHEN UPPER(text) LIKE '%FCLOSE%' THEN 'FCLOSE (fermeture)'
        WHEN UPPER(text) LIKE '%FFLUSH%' THEN 'FFLUSH (flush)'
        WHEN UPPER(text) LIKE '%FILE_TYPE%' THEN 'FILE_TYPE (dÃ©claration)'
        ELSE 'AUTRE'
    END
ORDER BY nb_occurrences DESC;</code></pre>
        </div>

        <h3>1.4 Export de l'audit complet</h3>
        <div class="code-container">
            <div class="code-header">
                <span>SQL - Export CSV pour Excel (schÃ©ma courant)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- GÃ©nÃ©rer un rapport CSV pour le schÃ©ma courant
SET MARKUP CSV ON
SET LINESIZE 32767
SET PAGESIZE 0
SPOOL utl_file_audit.csv

SELECT
    USER AS owner,
    name,
    type,
    line,
    REPLACE(TRIM(text), ',', ';') AS code_line
FROM user_source
WHERE UPPER(text) LIKE '%UTL_FILE%'
ORDER BY name, type, line;

SPOOL OFF
SET MARKUP CSV OFF</code></pre>
        </div>
    </section>

    <!-- Ce que tu attends des admins -->
    <section>
        <h2>â³ Ce que tu attends des Admins OCI</h2>

        <div class="alert alert-warning">
            <span class="alert-icon">ğŸ“¥</span>
            <div>
                <strong>Informations Ã  recevoir</strong><br>
                Une fois que tu auras ces informations, tu pourras continuer les Ã©tapes 3, 4 et 5.
            </div>
        </div>

        <div class="card-grid">
            <div class="card">
                <h4>1. URI du Bucket</h4>
                <p>Format attendu :</p>
                <code style="background:#f5f5f5;padding:5px;display:block;margin-top:10px;font-size:0.85rem;word-break:break-all;">
                https://objectstorage.eu-paris-1.oraclecloud.com/n/[namespace]/b/[bucket]/o/
                </code>
                <p style="margin-top:10px;"><strong>ReÃ§u :</strong> <input type="text" id="bucket_uri" style="width:100%;padding:5px;margin-top:5px;" placeholder="Coller l'URI ici..."></p>
            </div>
            <div class="card">
                <h4>2. Nom du Credential</h4>
                <p>Le credential DBMS_CLOUD crÃ©Ã© en base pour l'authentification.</p>
                <p style="margin-top:10px;"><strong>ReÃ§u :</strong> <input type="text" id="credential_name" style="width:100%;padding:5px;margin-top:5px;" placeholder="Ex: OCI_CREDENTIAL"></p>
            </div>
            <div class="card">
                <h4>3. ACL RÃ©seau</h4>
                <p>Confirmation que la base peut accÃ©der Ã  *.oraclecloud.com:443</p>
                <p style="margin-top:10px;">
                    <label><input type="checkbox" id="acl_confirmed"> ConfirmÃ© par les admins</label>
                </p>
            </div>
            <div class="card">
                <h4>4. Dossiers crÃ©Ã©s</h4>
                <p>Les prefixes (dossiers) crÃ©Ã©s dans le bucket.</p>
                <p style="margin-top:10px;"><strong>Liste :</strong></p>
                <textarea id="folders_list" style="width:100%;height:60px;padding:5px;" placeholder="DATA_EXPORT/&#10;LOG_DIR/&#10;REPORTS/"></textarea>
            </div>
        </div>

        <div style="text-align:center;margin-top:20px;">
            <button onclick="saveConfig()" style="background:var(--primary);color:white;padding:10px 30px;border:none;border-radius:5px;cursor:pointer;font-size:1rem;">
                ğŸ’¾ Sauvegarder (localStorage)
            </button>
        </div>
    </section>

    <!-- Ã‰tape 3 : Table de mapping -->
    <section>
        <h2>ğŸ“Š Ã‰tape 3 : CrÃ©er la Table de Mapping</h2>

        <div class="alert alert-info">
            <span class="alert-icon">â³</span>
            <div>
                <strong>PrÃ©requis</strong><br>
                Tu dois avoir reÃ§u l'URI du bucket des admins OCI avant de crÃ©er cette table.
            </div>
        </div>

        <div class="code-container">
            <div class="code-header">
                <span>SQL - CrÃ©ation de la table de mapping (schÃ©ma courant)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- ============================================
-- CRÃ‰ATION TABLE DE MAPPING - SCHÃ‰MA COURANT
-- ============================================
-- La table sera crÃ©Ã©e dans le schÃ©ma oÃ¹ tu es connectÃ©

-- Afficher le schÃ©ma courant
SELECT USER AS schema_courant FROM DUAL;

-- CrÃ©er la table de mapping (dans le schÃ©ma courant)
CREATE TABLE utl_file_directory_mapping (
    mapping_id         NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    oracle_directory   VARCHAR2(128) NOT NULL UNIQUE,
    object_storage_uri VARCHAR2(1000) NOT NULL,
    credential_name    VARCHAR2(128) DEFAULT 'OCI_CREDENTIAL',
    is_active          VARCHAR2(1) DEFAULT 'Y',
    created_date       DATE DEFAULT SYSDATE
);

-- Index pour performance
CREATE INDEX idx_mapping_dir ON utl_file_directory_mapping(oracle_directory);

-- VÃ©rifier la crÃ©ation
SELECT table_name FROM user_tables WHERE table_name = 'UTL_FILE_DIRECTORY_MAPPING';</code></pre>
        </div>

        <h3>InsÃ©rer les mappings</h3>
        <div class="code-container" id="code-insert-mappings">
            <div class="code-header">
                <span>SQL - Insertion des mappings <span class="auto-update-badge" style="display:none; background:#4caf50; color:white; padding:2px 8px; border-radius:10px; font-size:0.75rem; margin-left:10px;">âœ… Mis Ã  jour auto</span></span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code id="sql-insert-mappings">-- ============================================
-- INSERTION DES MAPPINGS DIRECTORY â†’ OBJECT STORAGE
-- ============================================

DECLARE
    v_base_uri VARCHAR2(500) := '<span class="placeholder-uri">[URI_BUCKET]</span>';
    v_credential VARCHAR2(100) := '<span class="placeholder-cred">[CREDENTIAL]</span>';
BEGIN
<span id="sql-insert-lines">    -- Adapter cette liste selon ton audit
    INSERT INTO utl_file_directory_mapping (oracle_directory, object_storage_uri, credential_name)
    VALUES ('DATA_EXPORT', v_base_uri || 'DATA_EXPORT/', v_credential);

    INSERT INTO utl_file_directory_mapping (oracle_directory, object_storage_uri, credential_name)
    VALUES ('LOG_DIR', v_base_uri || 'LOG_DIR/', v_credential);

    INSERT INTO utl_file_directory_mapping (oracle_directory, object_storage_uri, credential_name)
    VALUES ('REPORT_DIR', v_base_uri || 'REPORT_DIR/', v_credential);

    -- Ajouter d'autres directories selon ton audit...</span>

    COMMIT;
END;
/

-- VÃ©rifier les mappings insÃ©rÃ©s
SELECT oracle_directory, object_storage_uri, credential_name
FROM utl_file_directory_mapping
ORDER BY oracle_directory;</code></pre>
        </div>
    </section>

    <!-- Ã‰tape 4 : Package wrapper -->
    <section>
        <h2>ğŸ“¦ Ã‰tape 4 : DÃ©ployer le Package Wrapper</h2>

        <div class="alert alert-info">
            <span class="alert-icon">ğŸ“„</span>
            <div>
                <strong>Package complet</strong><br>
                Le code complet du package UTL_FILE_WRAPPER est disponible dans le document principal :
                <a href="migration-utl-file-exacc.html#wrapper" style="color:var(--secondary);">migration-utl-file-exacc.html â†’ Section Package Wrapper</a>
            </div>
        </div>

        <h3>RÃ©sumÃ© des Ã©tapes</h3>
        <ol style="padding-left: 20px;">
            <li style="margin: 10px 0;">Copier le code du <strong>Package Specification</strong> et l'exÃ©cuter</li>
            <li style="margin: 10px 0;">Copier le code du <strong>Package Body</strong> et l'exÃ©cuter</li>
            <li style="margin: 10px 0;">VÃ©rifier que le package est VALID :
                <code style="background:#f5f5f5;padding:3px 8px;margin-left:10px;">SELECT status FROM user_objects WHERE object_name = 'UTL_FILE_WRAPPER';</code>
            </li>
            <li style="margin: 10px 0;">Donner les grants aux utilisateurs qui en ont besoin</li>
        </ol>
    </section>

    <!-- Ã‰tape 5 : Migration -->
    <section>
        <h2>ğŸ”„ Ã‰tape 5 : CrÃ©er le Synonyme et Tester</h2>

        <div class="alert alert-success">
            <span class="alert-icon">â­</span>
            <div>
                <strong>MÃ©thode utilisÃ©e : Le Synonyme</strong><br>
                Avec plus de 1000 utilisations de UTL_FILE, le synonyme est la seule option viable. ZÃ©ro modification de code = zÃ©ro risque d'erreur.
            </div>
        </div>

        <h3>âœ… CrÃ©ation du Synonyme</h3>

        <div class="alert alert-info" style="margin-bottom: 15px;">
            <span class="alert-icon">ğŸ’¡</span>
            <div>
                <strong>Pourquoi le synonyme est la meilleure solution ?</strong>
                <table style="margin: 15px 0; width: 100%;">
                    <tr>
                        <th style="background: var(--primary); color: white; padding: 10px;">Avantage</th>
                        <th style="background: var(--primary); color: white; padding: 10px;">Explication</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>ZÃ©ro modification de code</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd;">Tes 1000+ procÃ©dures restent identiques, pas de risque d'introduire des bugs</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>Rollback instantanÃ©</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd;">Si problÃ¨me, tu supprimes le synonyme et tout redevient comme avant en 1 seconde</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>Pas de tests de non-rÃ©gression</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd;">Le code n'ayant pas changÃ©, pas besoin de tout re-tester ligne par ligne</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>Migration en 5 minutes</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd;">Au lieu de jours/semaines pour modifier 1000 procÃ©dures</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>Transparent pour les devs</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd;">Les dÃ©veloppeurs continuent Ã  Ã©crire <code>UTL_FILE</code> sans rien changer</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="alert alert-warning" style="margin-bottom: 15px;">
            <span class="alert-icon">âš ï¸</span>
            <div>
                <strong>PrÃ©requis : PrivilÃ¨ge CREATE PUBLIC SYNONYM</strong><br>
                Pour crÃ©er un synonyme PUBLIC, tu dois avoir le privilÃ¨ge <code>CREATE PUBLIC SYNONYM</code> ou Ãªtre connectÃ© en tant que DBA/SYS.
            </div>
        </div>

        <div class="code-container">
            <div class="code-header">
                <span>SQL - Migration par SYNONYME PUBLIC (tous les schÃ©mas)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- ============================================
-- MIGRATION UTL_FILE PAR SYNONYME PUBLIC
-- ============================================
-- Avantage : UNE SEULE commande pour TOUS les schÃ©mas !
-- ExÃ©cute ce script en tant que DBA ou utilisateur avec CREATE PUBLIC SYNONYM

-- Afficher l'utilisateur courant
SELECT USER AS utilisateur_courant FROM DUAL;


-- Ã‰TAPE 1 : Identifier le schÃ©ma oÃ¹ est dÃ©ployÃ© le wrapper
-- --------------------------------------------------------
-- Le wrapper doit Ãªtre dans UN schÃ©ma (ex: SCHEMA_COMMON ou le premier schÃ©ma migrÃ©)
SELECT owner, object_name, object_type, status
FROM dba_objects
WHERE object_name = 'UTL_FILE_WRAPPER'
  AND object_type IN ('PACKAGE', 'PACKAGE BODY')
ORDER BY owner;
-- Note le OWNER oÃ¹ le wrapper est VALID (ex: SCHEMA_COMMON)


-- Ã‰TAPE 2 : CrÃ©er le SYNONYME PUBLIC
-- ----------------------------------
-- âš ï¸ REMPLACE "SCHEMA_WRAPPER" par le schÃ©ma oÃ¹ tu as dÃ©ployÃ© le wrapper
CREATE OR REPLACE PUBLIC SYNONYM UTL_FILE FOR SCHEMA_WRAPPER.UTL_FILE_WRAPPER;

-- VÃ©rifier que le synonyme est crÃ©Ã©
SELECT owner, synonym_name, table_owner, table_name
FROM dba_synonyms
WHERE synonym_name = 'UTL_FILE'
  AND owner = 'PUBLIC';


-- Ã‰TAPE 3 : Recompiler TOUS les schÃ©mas impactÃ©s
-- ----------------------------------------------
-- Liste des schÃ©mas utilisant UTL_FILE
SELECT DISTINCT owner
FROM dba_source
WHERE UPPER(text) LIKE '%UTL_FILE%'
  AND owner NOT IN ('SYS', 'SYSTEM', 'ORACLE_OCM')
ORDER BY owner;

-- Recompiler chaque schÃ©ma (adapter la liste)
BEGIN
    DBMS_UTILITY.COMPILE_SCHEMA(schema => 'SCHEMA_APP1', compile_all => FALSE);
    DBMS_UTILITY.COMPILE_SCHEMA(schema => 'SCHEMA_APP2', compile_all => FALSE);
    DBMS_UTILITY.COMPILE_SCHEMA(schema => 'SCHEMA_BATCH', compile_all => FALSE);
    -- Ajouter les autres schÃ©mas...
END;
/

-- Ou recompiler automatiquement TOUS les schÃ©mas impactÃ©s
BEGIN
    FOR rec IN (
        SELECT DISTINCT owner
        FROM dba_source
        WHERE UPPER(text) LIKE '%UTL_FILE%'
          AND owner NOT IN ('SYS', 'SYSTEM', 'ORACLE_OCM')
    ) LOOP
        DBMS_OUTPUT.PUT_LINE('Recompilation du schÃ©ma: ' || rec.owner);
        DBMS_UTILITY.COMPILE_SCHEMA(schema => rec.owner, compile_all => FALSE);
    END LOOP;
END;
/


-- Ã‰TAPE 4 : VÃ©rifier qu'il n'y a plus d'objets invalides
-- -----------------------------------------------------
SELECT owner, object_name, object_type, status
FROM dba_objects
WHERE status = 'INVALID'
  AND owner NOT IN ('SYS', 'SYSTEM', 'ORACLE_OCM')
ORDER BY owner, object_name;
-- Cette requÃªte doit retourner 0 ligne


-- ============================================
-- TEST RAPIDE (depuis n'importe quel schÃ©ma)
-- ============================================
SET SERVEROUTPUT ON
DECLARE
    v_file UTL_FILE.FILE_TYPE;
BEGIN
    DBMS_OUTPUT.PUT_LINE('Test depuis le schÃ©ma: ' || USER);
    v_file := UTL_FILE.FOPEN('DATA_EXPORT', 'test_' || USER || '.txt', 'W');
    UTL_FILE.PUT_LINE(v_file, 'Test synonyme PUBLIC OK - ' || SYSDATE);
    UTL_FILE.FCLOSE(v_file);
    DBMS_OUTPUT.PUT_LINE('âœ… Synonyme PUBLIC fonctionne pour ' || USER || ' !');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('âŒ Erreur: ' || SQLERRM);
END;
/</code></pre>
        </div>

        <h3>ğŸ”„ Rollback si problÃ¨me</h3>
        <div class="code-container">
            <div class="code-header">
                <span>SQL - Annuler la migration (schÃ©ma courant)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- ============================================
-- ROLLBACK - SCHÃ‰MA COURANT
-- ============================================
-- En cas de problÃ¨me, revenir Ã  UTL_FILE original

-- Afficher le schÃ©ma courant
SELECT USER AS schema_courant FROM DUAL;

-- Supprimer le synonyme (schÃ©ma courant)
DROP SYNONYM UTL_FILE;

-- Si un synonyme PUBLIC avait Ã©tÃ© crÃ©Ã© (nÃ©cessite privilÃ¨ges DBA):
-- DROP PUBLIC SYNONYM UTL_FILE;

-- Recompiler le schÃ©ma courant pour revenir au package Oracle natif
BEGIN
    DBMS_UTILITY.COMPILE_SCHEMA(schema => USER, compile_all => FALSE);
END;
/

-- VÃ©rifier - doit afficher le vrai UTL_FILE (SYS.UTL_FILE)
SELECT synonym_name, table_owner, table_name
FROM user_synonyms
WHERE synonym_name = 'UTL_FILE';
-- Si aucun rÃ©sultat = OK, le code utilise le vrai UTL_FILE de SYS</code></pre>
        </div>

    </section>

    <!-- Test final -->
    <section>
        <h2>âœ… Test Final</h2>

        <div class="code-container">
            <div class="code-header">
                <span>SQL - Test d'Ã©criture/lecture (schÃ©ma courant)</span>
                <button class="copy-btn" onclick="copyCode(this)">ğŸ“‹ Copier</button>
            </div>
            <pre><code>-- ============================================
-- TEST COMPLET - SCHÃ‰MA COURANT
-- ============================================
-- ExÃ©cute ce test connectÃ© au schÃ©ma migrÃ©

-- Afficher le schÃ©ma courant
SELECT USER AS schema_courant FROM DUAL;

-- Activer l'affichage
SET SERVEROUTPUT ON

DECLARE
    v_file   utl_file_wrapper.file_type;
    v_line   VARCHAR2(32767);
    v_test   VARCHAR2(100) := 'Test migration ' || USER || ' - ' || TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS');
BEGIN
    DBMS_OUTPUT.PUT_LINE('=== Test pour le schÃ©ma: ' || USER || ' ===');
    DBMS_OUTPUT.PUT_LINE('');

    -- Test Ã©criture
    v_file := utl_file_wrapper.fopen('DATA_EXPORT', 'test_migration_' || USER || '.txt', 'W');
    utl_file_wrapper.put_line(v_file, v_test);
    utl_file_wrapper.fclose(v_file);
    DBMS_OUTPUT.PUT_LINE('âœ… Ã‰criture OK');

    -- Test lecture
    v_file := utl_file_wrapper.fopen('DATA_EXPORT', 'test_migration_' || USER || '.txt', 'R');
    utl_file_wrapper.get_line(v_file, v_line);
    utl_file_wrapper.fclose(v_file);

    IF v_line = v_test THEN
        DBMS_OUTPUT.PUT_LINE('âœ… Lecture OK - Contenu vÃ©rifiÃ©');
    ELSE
        DBMS_OUTPUT.PUT_LINE('âŒ Contenu diffÃ©rent !');
    END IF;

    -- Nettoyage
    utl_file_wrapper.fremove('DATA_EXPORT', 'test_migration_' || USER || '.txt');
    DBMS_OUTPUT.PUT_LINE('âœ… Suppression OK');

    DBMS_OUTPUT.PUT_LINE('');
    DBMS_OUTPUT.PUT_LINE('ğŸ‰ MIGRATION RÃ‰USSIE POUR LE SCHÃ‰MA: ' || USER);

EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('âŒ Erreur pour ' || USER || ' : ' || SQLERRM);
END;
/</code></pre>
        </div>
    </section>

</div>

<footer>
    <p><strong>Guide DBA - Migration UTL_FILE vers ExaCC</strong></p>
    <p>Document simplifiÃ© pour le pÃ©rimÃ¨tre DBA uniquement</p>
</footer>

<script>
function copyCode(button) {
    const codeContainer = button.closest('.code-container');
    const code = codeContainer.querySelector('pre code').innerText;

    navigator.clipboard.writeText(code).then(() => {
        const originalText = button.innerHTML;
        button.innerHTML = 'âœ… CopiÃ©!';
        button.classList.add('copied');
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('copied');
        }, 2000);
    });
}

function saveConfig() {
    const config = {
        bucket_uri: document.getElementById('bucket_uri').value,
        credential_name: document.getElementById('credential_name').value,
        acl_confirmed: document.getElementById('acl_confirmed').checked,
        folders_list: document.getElementById('folders_list').value
    };
    localStorage.setItem('exacc_migration_config', JSON.stringify(config));

    // Mettre Ã  jour les scripts SQL automatiquement
    updateSQLScripts(config);

    alert('âœ… Configuration sauvegardÃ©e et scripts SQL mis Ã  jour !');
}

function updateSQLScripts(config) {
    const bucketUri = config.bucket_uri || '[URI_BUCKET]';
    const credentialName = config.credential_name || '[CREDENTIAL]';
    const foldersList = config.folders_list || '';

    // Mettre Ã  jour les placeholders URI
    document.querySelectorAll('.placeholder-uri').forEach(el => {
        el.textContent = bucketUri;
        if (bucketUri !== '[URI_BUCKET]') {
            el.style.background = '#c8e6c9';
            el.style.padding = '2px 4px';
            el.style.borderRadius = '3px';
        }
    });

    // Mettre Ã  jour les placeholders CREDENTIAL
    document.querySelectorAll('.placeholder-cred').forEach(el => {
        el.textContent = credentialName;
        if (credentialName !== '[CREDENTIAL]') {
            el.style.background = '#c8e6c9';
            el.style.padding = '2px 4px';
            el.style.borderRadius = '3px';
        }
    });

    // GÃ©nÃ©rer les INSERT pour chaque dossier
    if (foldersList.trim()) {
        const folders = foldersList.split('\n')
            .map(f => f.trim().replace(/\/$/, ''))  // Enlever les / Ã  la fin
            .filter(f => f.length > 0);

        if (folders.length > 0) {
            let insertStatements = '    -- GÃ©nÃ©rÃ© automatiquement depuis ta liste de dossiers\n';
            folders.forEach((folder, index) => {
                insertStatements += `    INSERT INTO utl_file_directory_mapping (oracle_directory, object_storage_uri, credential_name)\n`;
                insertStatements += `    VALUES ('${folder.toUpperCase()}', v_base_uri || '${folder.toUpperCase()}/', v_credential);\n`;
                if (index < folders.length - 1) {
                    insertStatements += '\n';
                }
            });

            const insertLinesEl = document.getElementById('sql-insert-lines');
            if (insertLinesEl) {
                insertLinesEl.innerHTML = insertStatements;
            }
        }
    }

    // Afficher les badges "Mis Ã  jour auto"
    document.querySelectorAll('.auto-update-badge').forEach(badge => {
        if (bucketUri !== '[URI_BUCKET]' || credentialName !== '[CREDENTIAL]') {
            badge.style.display = 'inline';
        }
    });
}

// Charger la config au dÃ©marrage
window.onload = function() {
    const saved = localStorage.getItem('exacc_migration_config');
    if (saved) {
        const config = JSON.parse(saved);
        document.getElementById('bucket_uri').value = config.bucket_uri || '';
        document.getElementById('credential_name').value = config.credential_name || '';
        document.getElementById('acl_confirmed').checked = config.acl_confirmed || false;
        document.getElementById('folders_list').value = config.folders_list || '';

        // Appliquer les valeurs aux scripts SQL au chargement
        updateSQLScripts(config);
    }
};
</script>

</body>
</html>
